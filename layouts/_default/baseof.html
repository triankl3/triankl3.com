<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        {{/*  OPENGRAPH / TWITTER META  */}}
        {{/*  Use frontmatter description when available, otherwise use main website description.  */}}
        {{- if isset .Params "Description" -}}
            <meta name="description" content="{{ .Params.Description }}" />
        {{- else -}}
            <meta name="description" content="{{ site.Params.Description }}" />
        {{- end -}}

        {{/*  Determine featured image if it exists  */}}
        {{ $featured_img := "" }}
        {{ if isset .Params "image" }}
            <!-- Prepare a compressed version of the feature image to use if on a post -->
            {{ $featured_img_path := print "img/" .Params.image }}
            {{ $featured_img = resources.Get $featured_img_path }}
            {{ $featured_img = $featured_img.Resize "x1024"}}

            {{ .Scratch.Set "featured_img" $featured_img }}
        {{- end -}}

        {{/*  Determine page title  */}}
        {{ $pageTitle := .Site.Title }}
        {{ if (.IsHome) }}
            {{ $pageTitle = print "Home | " .Site.Title }}
        {{ else if (.Page.Title) }}
            {{ $pageTitle = print .Page.Title " | " .Site.Title }}
        {{- end -}}
        <title>
            {{- $pageTitle -}}
        </title> 

        <!-- Facebook Meta Tags -->
        <meta property="og:title" content="{{ $pageTitle }}">
        <meta property="og:description" content='{{- if isset .Params "description" -}} {{- .Description -}} {{- else -}} {{- .Site.Params.Description -}} {{- end -}}'>
        <meta property="og:image" content='{{- if isset .Params "image" -}} {{- $featured_img.Permalink -}} {{- end -}}'>
        <meta property="og:url" content="{{ .Page.Permalink }}">
        <meta property="og:site_name" content="{{ .Site.Title }}">
        <meta property="og:type" content="article">
                
        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ .Page.Title }}">
        <meta name="twitter:description" content='{{- if isset .Params "description" -}} {{- .Description -}} {{- else -}} {{- .Site.Params.Description -}} {{- end -}}'>
        <meta name="twitter:image" content='{{- if isset .Params "image" -}} {{- $featured_img.Permalink -}} {{ end -}}'>

        {{/* Load needed CSS */}}
        {{ $normalize_style := resources.Get "css/modern-normalize.css" | resources.Minify }}
        <link rel="stylesheet" href="{{ $normalize_style.RelPermalink }}">

        {{ $main_style := resources.Get "sass/main.scss" | resources.ExecuteAsTemplate "main_parsed.scss" . | resources.ToCSS (dict "targetPath" "css/site.css" "outputStyle" "compressed") | resources.Minify }}
        <link rel="stylesheet" href="{{ $main_style.RelPermalink }}">

        {{ $photoswipe_style := resources.Get "css/photoswipe.css"  | resources.Minify }}
        <link rel="stylesheet" href="{{ $photoswipe_style.RelPermalink }}">
    </head>
    <body>
        <div id="effect-reveal"></div>
        <div id="effect-noise"></div>
        <div id="effect-gradient"></div>
        <div class="effect-grid-container">
            <div class="effect-grid">
                <div class="effect-grid-fade"></div>
                <div class="effect-grid-lines"></div>
            </div>
        </div>

        <nav {{ if not .IsHome }} {{ if not (eq .Parent .Site.Home) }} class="nav-wide" {{ end }} {{ end }}>
            <a id="nav-logo" href="/"><img src="/img/logo.svg"></a>
            <ul id="nav-pages">
                <li><a href="/project">projects</a></li>
                <li><a href="/blog">blog</a></li>
                <li><a href="/about">about</a></li>
                <li><a href="/contact">contact</a></li>
            </ul>
            <ul id="nav-socials">
                <li><a target="_blank" href="{{ site.Params.contact.github }}"><img src="/img/github.svg"></a></li>
                <li><a target="_blank" href="{{ site.Params.contact.linkedin }}"><img src="/img/linkedin.svg"></a></li>
                <li><a target="_blank" href="{{ site.Params.contact.twitter }}"><img src="/img/twitter.svg"></a></li>
                <li><a href="mailto:{{ site.Params.contact.email }}"><img src="/img/email.svg"></a></li>
            </ul>
        </nav>

        <main>
            {{ block "main" . }}{{ end }}
        </main>

        <footer>
            <p>{{ .Site.Copyright }} <a href="{{ .Site.Params.source }}" target="_blank">License and source code available on GitHub.</a></p>
        </footer>
    </body>

    {{/* Load needed JS */}}
    {{ $vanillaTilt_js := resources.Get "js/vanillaTilt.js" | minify }}
    <script src="{{ $vanillaTilt_js.RelPermalink }}"></script>

    {{ $photoswipe_js := resources.Get "js/photoswipe.js" | minify }}
    <script src="{{ $photoswipe_js.RelPermalink }}"></script>

    {{ $photoswipe_lightbox_js := resources.Get "js/photoswipe-lightbox.js" | minify }}
    <script src="{{ $photoswipe_lightbox_js.RelPermalink }}"></script>

    <script> // Initialize scripts here
        // Init/Apply tilt effect
        document.querySelectorAll('.tilt-img').forEach((elem) => {
            VanillaTilt.init(elem, {
                reverse: false,
                max: 10,
                scale: 0.95,    
                speed: 2000,
            });
        });
        document.querySelectorAll('.tilt-post').forEach((elem) => {
            VanillaTilt.init(elem, {
                reverse: true,
                max: 10,
                scale: 0.95,
                speed: 1000,
            });
        });

        // Initialize lightbox script
        const lightbox = new PhotoSwipeLightbox({
            gallery: '.pspw-lightbox',
            children: 'a',

            initialZoomLevel: 'fit',
            secondaryZoomLevel: 3,
            maxZoomLevel: 3,

            showAnimationDuration: 200,
            hideAnimationDuration: 200,

            pswpModule: PhotoSwipe
        }); 
        lightbox.init();
    </script>
</html>