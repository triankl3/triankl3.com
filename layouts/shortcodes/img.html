{{/*  Image shortcode, use this to properly display images in markdown  */}}
{{/*  Uses figure and sourceset to set different sizes, while scaling the images using HuGo Image Processing */}}
{{/*  Use alt to also specify a figcaption, use zoomable="false" to disable lightbox effects */}}

{{- $alt := .Get "alt" -}}
{{- $res := .Page.Resources.GetMatch (printf "*%s*" (.Get "src")) -}}
{{- $zoomable := .Get "zoomable" -}}

{{- $ws := slice 720 1080 2160 2560 -}}

{{- $srcset := slice -}}
    {{- range $ws -}}

    {{/* To avoid creating an image that is larger than the source */}}
    {{- if (le . $res.Width) -}}
        {{- $w := printf "%dx" . -}}
        {{- $url := ($res.Resize $w).RelPermalink | safeURL -}}
        {{- $fmt := printf "%s %dw" $url . -}}
        {{- $srcset = $srcset | append $fmt -}}
    {{- end -}}
{{- end -}}

{{- $set := delimit $srcset "," -}}

<figure {{ if not (in $zoomable "false") }} class="pspw-lightbox" {{ end }}>
{{ if not (in $zoomable "false") }}<a href="{{ $res.RelPermalink }}" data-pswp-width="{{ $res.Width }}" data-pswp-height="{{ $res.Height }}" target="_blank">{{- end -}}
<img {{ if not (in $zoomable "false") }} class="tilt-img" {{ end }} srcset="{{ $set }}" sizes="(max-width: 720px) 720px, 100vw" src="{{ $res.RelPermalink }}" alt="{{ $alt }}" width="100%" height="auto"/>
{{ if not (in $zoomable "false") }}</a>{{ end }}
<figcaption>{{ $alt }}</figcaption>
</figure>